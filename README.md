# LogWatch

A real-time Bash log parser and alert engine that monitors SSH auth logs for security threats and prints color-coded terminal alerts.

[![asciicast](https://asciinema.org/a/VoVY5ac1Le8S42se.svg)](https://asciinema.org/a/VoVY5ac1Le8S42se)

---

## Features

- **Real-time log monitoring** — tails any auth log file continuously as new entries arrive
- **Failed SSH detection** — flags every failed password attempt with the source IP and attempt count
- **Brute force detection** — triggers a blocking recommendation when a single IP exceeds 5 failed attempts
- **Suspicious login detection** — catches successful logins from IPs that previously failed authentication
- **Sudo abuse detection** — alerts on privilege escalation attempts via `/bin/bash` or `/bin/su`
- **Color-coded terminal alerts** — yellow for failed logins, red for brute force and sudo abuse, green for suspicious logins
- **Persistent alerts.log** — every alert is written to disk with a full timestamp for post-incident review

---

## Requirements

- Bash 4.0 or higher (associative array support)
- `tput` for terminal color output
- `tail` for real-time log following
- `awk` and `grep` for pattern extraction
- Linux system with a standard auth log (tested on Ubuntu 22.04)

---

## Installation

```bash
# Clone the repository
git clone https://github.com/youruser/logwatch.git
cd logwatch

# Make both scripts executable
chmod +x logwatch.sh simulate.sh
```

---

## Usage

Run each script in a separate terminal.

**Terminal 1 — start the monitor:**

```bash
./logwatch.sh auth.log
```

**Terminal 2 — run the simulation to generate log entries:**

```bash
./simulate.sh
```

LogWatch defaults to `auth.log` in the current directory if no argument is provided. To monitor a system log directly:

```bash
./logwatch.sh /var/log/auth.log
```

---

## Sample Output

```
╔══════════════════════════════════════════════════════╗
║          ThreatIntel — Log Monitor v1.0              ║
╚══════════════════════════════════════════════════════╝

  Monitoring : auth.log
  Alerts log : alerts.log
  Started    : 2025-06-01 14:30:00

──────────────────────────────────────────────────────

[FAILED LOGIN]    14:30:05 — 192.168.1.105 attempted login (attempt #1)
[FAILED LOGIN]    14:30:06 — 192.168.1.105 attempted login (attempt #2)
[FAILED LOGIN]    14:30:07 — 192.168.1.105 attempted login (attempt #3)
[FAILED LOGIN]    14:30:08 — 192.168.1.105 attempted login (attempt #4)
[FAILED LOGIN]    14:30:09 — 192.168.1.105 attempted login (attempt #5)
[BRUTE FORCE]     192.168.1.105 has 5 failed attempts — BLOCKING RECOMMENDED
[SUSPICIOUS LOGIN] 14:30:10 — 192.168.1.105 succeeded after 5 failed attempt(s)
[SUDO ABUSE]      14:30:15 — baduser attempted privilege escalation via COMMAND=/bin/bash
[SUDO ABUSE]      14:30:16 — baduser attempted privilege escalation via COMMAND=/bin/su
```

Alert colors in terminal output: failed logins print in yellow, brute force and sudo abuse in red, suspicious logins in green.

---

## How It Works

**Failed SSH Detection.** Each line is checked for the string `Failed password`. When matched, the source IP is extracted and its attempt counter increments in a Bash associative array. An alert fires on every match.

**Brute Force Detection.** When a single IP reaches 5 or more failed attempts, a `BLOCKING RECOMMENDED` alert fires once. Additional alerts fire every 5 subsequent attempts to surface persistent attackers without flooding the terminal.

**Suspicious Login Detection.** When `Accepted password` is matched, the source IP is checked against the failed attempts array. If the IP has any prior failures on record, a suspicious login alert fires with the exact failure count, catching successful logins that follow a brute force pattern.

**Sudo Abuse Detection.** Lines containing both `sudo` and `COMMAND=/bin/bash` or `COMMAND=/bin/su` are flagged. The username and full command are extracted and included in the alert, covering the most common privilege escalation paths.

**Alert Persistence.** Every alert that prints to the terminal also appends a timestamped plain-text line to `alerts.log`, creating an audit trail that survives terminal sessions.

---

## File Structure

```
logwatch/
├── logwatch.sh     # Real-time monitor and alert engine
├── simulate.sh     # Auth log event simulator for testing
├── auth.log        # Generated by simulate.sh
├── alerts.log      # Written by logwatch.sh at runtime
└── README.md
```

---

## Tech Stack

| Component | Tool |
|---|---|
| Log tailing | `tail -f` |
| Pattern matching | `grep` |
| IP and field extraction | `awk`, `grep -oE`, `grep -oP` |
| Attempt tracking | Bash associative arrays |
| Terminal colors | `tput` |
| Timestamping | `date` |

Everything runs in pure Bash with no external dependencies beyond standard Linux utilities.

---

## Disclaimer

LogWatch is intended for use in authorized lab environments, security training, and defensive research only. Do not deploy against systems or logs you do not own or have explicit permission to monitor. The authors accept no liability for misuse.
